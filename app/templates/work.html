{# macro to display a ?p ?o combination for this item #}
{# it's possible that ?o is a list, if there are multiple matches #}
{% macro unpack(payload) -%}
    {% if payload is string %}
        {{ payload }}
    {% else %} {# there are multiple matches #}
        {% for item in payload %}
            <span> {{ item }} </span>
        {% endfor %}
    {% endif %} 
{% endmacro %}

<html>
    <head>
        <title>SLoBR Episode View</title>
        {% assets "scss_all" %}
            <link rel="stylesheet" type="text/css" href="{{ ASSET_URL }}">
        {% endassets %}
    </head>
    <body>
        <div id="banner">
            <span id="banner-items"><a href="/">SLoBR </a>| BBC MAIN BANNER GOES HERE | NEWS | SPORTS | WEATHER | FALAFEL RECIPES | TV | RADIO | IPLAYER | SEARCH</span>
        </div>
        <div id="content">
            <div class="header">SLoBR Work View</div>
            <div class="listing" id="work">
               <div class="two-thirds-column left">
                   <div class="contentblock">
                       <div class="title">
                           {{ unpack(work["dct:title"]) }}
                       </div>
                       <div>
                       Contributors:
                       {% for c in contributors %}
                         <a href="/contributor?contributor={{ c }}">
                            {{ contributors[c] }}
                         </a> 
                       {% endfor %}
                       </div>
                       <div>
                       Recorded as:
                       {{ unpack(work["mo:recorded_as"]) }}
                       </div>
                   </div>
                   <div id="scoreimages">
                       {% if images is iterable %}
                           {% for image in images %}
                                {% if loop.index < 10 %} {# only show first 10 images for now as they are pretty huge - in future, do better with diva.js #}
                                  <img src={{ image }}/>
                                {% endif %}
                           {% endfor %}
                       {% endif %}
                   </div>
              </div>
               <div class="one-third-column right">
                   <div class="explore">
                       {# there may be more than one contributor #}
                       {% if work["dct:contributor"] is string %}
                       <a href=episodes?contributor={{work["dct:contributor"] }}>All episodes featuring these contributors</a>
                       {% else %}
                       <a href=episodes?contributor={{work["dct:contributor"]|join("|") }}>All episodes featuring these contributors</a>
                       {% endif %}
                   </div>

               </div>
            </div>
        </div>
    </body>
</html>
